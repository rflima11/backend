ALTER TABLE CITY ADD COLUMN STATE_ID INT NULL
    CONSTRAINT FK_CITY_STATE REFERENCES public.STATE (ID)
        ON UPDATE CASCADE ON DELETE CASCADE;

UPDATE CITY SET STATE_ID = SUBQUERY.STATE_ID
FROM (SELECT CITY.ID AS CITY_ID, STATE.ID AS STATE_ID
        FROM CITY
        INNER JOIN STATE ON CITY.STATE_CODE = STATE.CODE) AS SUBQUERY
WHERE CITY.ID = SUBQUERY.CITY_ID;

ALTER TABLE CITY ALTER COLUMN STATE_ID SET NOT NULL;

ALTER TABLE CITY DROP COLUMN STATE_NAME, DROP COLUMN STATE_INITIALS, DROP COLUMN STATE_CODE;